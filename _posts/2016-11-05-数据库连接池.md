---
title: 数据库连接池
date: 2016-11-05 20:40:52
math: y
---
对于共享资源，有一个很经典的设计模式就是：资源池（resource pool），这种模式就是要解决资源的频繁分配与释放所造成的问题。

#### 基本思想
连接池就是是在系统初始化的时候，将数据库连接作为对象存储在内存中，当用户需要访问数据库时，并非建立一个新的连接，而是从连接池中取出一个已建立的空闲连接对象。使用完毕后，用户也并非将连接关闭，而是将连接放回到连接池中，以便下一个请求访问使用，当应用程序向连接池请求的数量大于最大连接数时，这些请求将被放入到等待队列中。而连接的建立、断开都由连接池自身来管理。


同时还可以通过设置连接池的参数来控制连接池中的初始连接数、连接的上下限数以及每个连接的最大使用次数、最大空闲时间等，也可以通过其自身的管理机制来监视数据库连接的数量、使用情况。


数据库连接池将负责与数据库连接的模块独立出来，方便维护，通过数据库连接池作为中转站，避免了对数据库服务端频繁的连接与断开操作，从而减少了资源占用，获得更快的响应时间。

#### 应用方法
连接池所处的位置

![连接池位置](http://i4.bvimg.com/595056/897913684d26bcf4.png)

一般情况下，执行一条sql语句，要经过的流程：

![sql执行流程](http://i4.bvimg.com/595056/be6e6f7c75d2cc75.png)

可以看到需要：
- TCP建立的连接的三次握手操作
- MYSQL认证的三次握手操作
- 真正的sql执行
- mysql的关闭
- TCP的四次握手关闭

建立连接是一个费时的活动，平均一次花费0.05s~1s的时间，而且系统还要分配内存资源，这样就造成网络IO较多，数据库的负载较高，响应时间较长及QPS（每秒查询率，即规定时间内处理流量多少）较低，而使用连接池后每次访问请求都会复用之前创建的连接。

常用的数据库连接池框架，也都是开发组推荐使用的：
- C3P0--hibernate
- DBCP--Spring